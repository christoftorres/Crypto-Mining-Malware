
var calltree = require('/Users/Christof/Downloads/calltree1096750.json');



function getChildren(calltree, i) {
	children = [];
	//console.log('------');
    var childCount = i === -1 ? calltree._rootCount : calltree._callNodeChildCount[i];
	//console.log('childcount: '+childCount);
     for (
        var childCallNodeIndex = 0;
        childCallNodeIndex < calltree._callNodeTable.length &&
        children.length < childCount;
        childCallNodeIndex++
     ) {
        if (
          calltree._callNodeTable.prefix[childCallNodeIndex] === i
        ) {
          children.push(childCallNodeIndex);
        }
    }
    return children;
}

var functions = new Map();
for (var i = 0; i < calltree._callNodeTable.length; i++) {
	var functionIndex = calltree._callNodeTable.func[i];
	if (calltree._funcTable.isJS[functionIndex]) {
		var functionObject = null;
		if (functions.has(functionIndex)) {
			functionObject = functions.get(functionIndex);
	    } else {
			functionObject = {};
			functionObject['totalTime'] = 0;
			functionObject['selfTime'] = 0;
			functionObject['functionName'] = calltree._stringTable._array[calltree._funcTable.name[functionIndex]];
			functionObject['fileName'] = calltree._stringTable._array[calltree._funcTable.fileName[functionIndex]];
			functionObject['lineNumber'] = calltree._funcTable.lineNumber[functionIndex];
			functions.set(functionIndex, functionObject);
		}
		var children = getChildren(calltree, i);
		for (var j = 0; j < children.length; j++) {
    		functionObject.totalTime += calltree._callNodeTimes.totalTime[children[j]];
    		functionObject.selfTime += calltree._callNodeTimes.selfTime[children[j]];
		}
	    /*//console.log(children);
	    var self_time = 0;
	    for (var j = 0; j < children.length; j++) {
	    	self_time += calltree._callNodeTimes.totalTime[children[j]];	
	    }
	    //console.log('self_time: '+self_time);*/
	    //console.log(func_index+' -> '+calltree._callNodeTable.prefix[i]+' '+i+' '+calltree._callNodeChildCount[i]+' '+calltree._callNodeTimes.totalTime[i]+' '+calltree._callNodeTimes.selfTime[i]+' '++' ('+calltree._stringTable._array[calltree._funcTable.fileName[func_index]]+':'+calltree._funcTable.lineNumber[func_index]+')');
	}
}

console.log(functions);
